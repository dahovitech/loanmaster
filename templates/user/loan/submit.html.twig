{% extends "@admin/base.html.twig" %}

{% block title %}
	{{ 'loan.submit.title'|trans }}
{% endblock %}

{% block body %}
	<!--breadcrumb-->
	<div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
		<div class="breadcrumb-title pe-3">{{ 'loan.submit.title'|trans }}</div>
		<div class="ps-3">
			<nav aria-label="breadcrumb">
				<ol class="breadcrumb mb-0 p-0">
					<li class="breadcrumb-item">
						<a href="{{ path('app_user_dashboard') }}">
							<i class="bx bx-home-alt"></i>
						</a>
					</li>
					<li class="breadcrumb-item">
						<a href="{{path('app_user_loan_list')}}">
							<i class="bx bx-list"></i>
							{{ 'loan.list.title'|trans }}</a>
					</li>
					<li class="breadcrumb-item active" aria-current="page">{{ 'loan.submit.title'|trans }}</li>
				</ol>
			</nav>
		</div>
	</div>
	<!--end breadcrumb-->

	<div class="row">
		<div class="col-md-4">
			<h6 class="mb-0 text-uppercase text-primary">{{ 'loan.calculator.title'|trans }}</h6>
			<hr class="mb-3" />
			<div class="card shadow-sm border-primary">
				<div class="card-body">
					<div class="loan-info mb-3">
						<b>{{ 'loan.form.amount'|trans }}</b>
						<span id="amount" class="text-primary fs-5">0</span>
						{{setting("devise")}}
					</div>
					<div class="loan-info mb-3">
						<b>{{ 'loan.form.interestRate'|trans }}</b>: <span class="text-secondary">3 %</span>
					</div>
					<div class="loan-info mb-3">
						<b>{{ 'loan.calculator.monthlyPayment'|trans }}</b>
						<span id="monthlyPayment" class="text-primary fs-5">0</span>
						{{setting("devise")}}
					</div>
					<div class="loan-info">
						<b>{{ 'loan.calculator.totalPayment'|trans }}</b>
						<span id="totalPayment" class="text-primary fs-5">0</span>
						{{setting("devise")}}
					</div>
				</div>
			</div>
		</div>

		<div class="col-md-8">
			<h6 class="mb-0 text-uppercase text-primary">{{ 'loan.submit.title'|trans }}</h6>
			<hr class="mb-3" />
			<div class="card shadow-sm">
				<div class="card-body">
					{{ form_start(form, {'attr': {'class': 'loan-form'}}) }}
					{{ form_widget(form) }}
					{{ form_end(form) }}
				</div>
			</div>
		</div>
	</div>

	<style>
		.loan-info {
			font-size: 1rem;
			margin-bottom: 0.8rem;
		}
		.card {
			border-radius: 0.5rem;
		}
		.card-body {
			font-size: 0.95rem;
		}
		.btn-primary {
			background-color: #0056b3;
			border-color: #0056b3;
		}
		.btn-primary:hover {
			background-color: #004494;
			border-color: #004494;
		}
	</style>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
    $(document).ready(function () { 
        var amountField = $('#loan_form_amount');
        var amountSee = $('#amount');
        var durationMonthsField = $('#loan_form_durationMonths');
        var monthlyPaymentField = $('#monthlyPayment');
        var totalPaymentField = $('#totalPayment');

        function calculatePayments() {
            var amount = parseFloat(amountField.val());
            var durationMonths = parseInt(durationMonthsField.val());
            var annualInterestRate = 3;
            var monthlyInterestRate = annualInterestRate / 100 / 12;

            // Calcul du paiement mensuel
            var monthlyPayment = amount * (monthlyInterestRate / (1 - Math.pow(1 + monthlyInterestRate, -durationMonths)));
            monthlyPaymentField.text(monthlyPayment.toFixed(2));

            // Calcul du paiement total
            var totalPayment = monthlyPayment * durationMonths;
            totalPaymentField.text(totalPayment.toFixed(2));
            amountSee.text(amount);
        }

        // DÃ©tecter les changements dans les champs amount et durationMonths
        amountField.on('input', calculatePayments);
        durationMonthsField.on('input', calculatePayments);
    });
</script>

{% endblock %}
