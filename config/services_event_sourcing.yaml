services:\n    # Event Sourcing Infrastructure\n    App\\Infrastructure\\EventSourcing\\EventStore:\n        arguments:\n            $connection: '@doctrine.dbal.default_connection'\n            $tableName: 'event_store'\n        tags:\n            - { name: 'event_sourcing.event_store' }\n\n    # Event Sourced Repositories\n    App\\Infrastructure\\EventSourcing\\Repository\\LoanEventSourcedRepository:\n        arguments:\n            $eventStore: '@App\\Infrastructure\\EventSourcing\\EventStore'\n        tags:\n            - { name: 'event_sourcing.repository' }\n\n    # Event Handlers pour les projections\n    App\\Infrastructure\\EventSourcing\\EventHandler\\LoanProjectionHandler:\n        arguments:\n            $connection: '@doctrine.dbal.default_connection'\n        tags:\n            - { name: 'messenger.message_handler' }\n\n    # Services d'audit\n    App\\Infrastructure\\EventSourcing\\AuditService:\n        arguments:\n            $connection: '@doctrine.dbal.default_connection'\n            $eventStore: '@App\\Infrastructure\\EventSourcing\\EventStore'\n        tags:\n            - { name: 'event_sourcing.audit' }\n\n    # Metrics Collector\n    App\\Infrastructure\\EventSourcing\\MetricsCollector:\n        arguments:\n            $connection: '@doctrine.dbal.default_connection'\n            $tableName: 'event_store_metrics'\n        tags:\n            - { name: 'event_sourcing.metrics' }\n\n    # Command Bus pour Event Sourcing\n    App\\Infrastructure\\EventSourcing\\CommandBus:\n        arguments:\n            $messageBus: '@messenger.bus.default'\n            $eventStore: '@App\\Infrastructure\\EventSourcing\\EventStore'\n            $auditService: '@App\\Infrastructure\\EventSourcing\\AuditService'\n            $metricsCollector: '@App\\Infrastructure\\EventSourcing\\MetricsCollector'\n\n    # Query Bus pour les projections\n    App\\Infrastructure\\EventSourcing\\QueryBus:\n        arguments:\n            $connection: '@doctrine.dbal.default_connection'\n            $metricsCollector: '@App\\Infrastructure\\EventSourcing\\MetricsCollector'\n\n    # Event Publisher\n    App\\Infrastructure\\EventSourcing\\EventPublisher:\n        arguments:\n            $messageBus: '@messenger.bus.default'\n        tags:\n            - { name: 'event_sourcing.publisher' }\n\n    # Snapshot Store pour optimisation\n    App\\Infrastructure\\EventSourcing\\SnapshotStore:\n        arguments:\n            $connection: '@doctrine.dbal.default_connection'\n            $tableName: 'aggregate_snapshots'\n\n    # Command Handlers\n    App\\Application\\Command\\Loan\\CreateLoanApplicationHandler:\n        arguments:\n            $repository: '@App\\Infrastructure\\EventSourcing\\Repository\\LoanEventSourcedRepository'\n            $snapshotStore: '@App\\Infrastructure\\EventSourcing\\SnapshotStore'\n        tags:\n            - { name: 'messenger.message_handler' }\n