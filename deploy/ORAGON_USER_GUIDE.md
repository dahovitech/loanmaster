# üéØ Guide d'utilisation du syst√®me Oragon - LoanMaster

**Version :** 1.0.0 Final  
**Auteur :** MiniMax Agent  
**Date :** 18 septembre 2025  

---

## üöÄ D√©marrage rapide

### Pour les administrateurs

1. **Acc√®s au tableau de bord**
   ```
   URL: /admin/oragon-translations
   Acc√®s: ROLE_ADMIN requis
   ```

2. **Gestion des traductions par entit√©**
   - Pages : `/admin/page-translations`
   - SEO : `/admin/seo-translations` 
   - Banques : `/admin/bank-translations`
   - Notifications : `/admin/notification-translations`
   - FAQ : `/admin/faq-translations`
   - Types de pr√™ts : `/admin/loan-type-translations`

### Pour les d√©veloppeurs

1. **Utilisation dans les templates Twig**
   ```twig
   {{ oragon_translate('nav.home') }}
   {{ oragon_t('admin.users', 'admin') }}
   {{ 'welcome.message'|oragon_format({'name': user.name}) }}
   ```

2. **Cr√©ation d'une nouvelle entit√© traduite**
   ```php
   // 1. Cr√©er l'entit√© Translation
   // 2. Ajouter la relation OneToMany dans l'entit√© principale
   // 3. Cr√©er le repository
   // 4. Ajouter le contr√¥leur d'administration
   ```

---

## üìã Fonctionnalit√©s principales

### üéõÔ∏è Interface d'administration

#### Tableau de bord centralis√©
- **Vue d'ensemble** : Statistiques globales de traduction
- **Progression par entit√©** : Pourcentage de completion par type
- **Gestion des langues** : Activation/d√©sactivation des langues
- **Actions en masse** : Synchronisation et export global

#### √âditeur de traductions avanc√©
- **Interface multi-onglets** : Navigation fluide entre les langues
- **R√©f√©rence par d√©faut** : Affichage du contenu de r√©f√©rence
- **Sauvegarde automatique** : Ctrl+S pour sauvegarder rapidement
- **Compteur de caract√®res** : Validation en temps r√©el
- **Copie depuis d√©faut** : Duplication rapide du contenu de base

#### Actions en masse
- **S√©lection multiple** : Traitement par lot des entit√©s
- **Suppression des vides** : Nettoyage automatique
- **Copie en masse** : Duplication depuis la langue par d√©faut
- **Export/Import** : Sauvegarde et restauration JSON

### üîß Outils en ligne de commande

#### Synchronisation des traductions
```bash
# Synchroniser toutes les traductions
php bin/console app:translation:sync --all-domains

# Synchroniser un domaine sp√©cifique
php bin/console app:translation:sync admin

# Afficher les statistiques
php bin/console app:translation:sync --stats
```

#### Migration depuis Gedmo
```bash
# Simulation de migration (recommand√©)
php bin/console app:migration:gedmo-to-oragon --dry-run

# Migration compl√®te avec sauvegarde
php bin/console app:migration:gedmo-to-oragon --backup

# Migration par entit√©
php bin/console app:migration:gedmo-to-oragon --entity=page
```

#### Nettoyage et optimisation
```bash
# V√©rification du syst√®me
php bin/console app:cleanup:gedmo --dry-run

# Suppression des anciennes tables Gedmo
php bin/console app:cleanup:gedmo --remove-tables

# Optimisation compl√®te
php bin/console app:cleanup:gedmo --remove-tables --optimize
```

---

## üõ†Ô∏è Guide technique

### Architecture du syst√®me

#### Pattern Oragon
```php
// Entit√© principale
class Page {
    #[ORM\OneToMany(mappedBy: 'translatable', targetEntity: PageTranslation::class)]
    private Collection $translations;
}

// Entit√© de traduction
class PageTranslation {
    #[ORM\ManyToOne(targetEntity: Page::class, inversedBy: 'translations')]
    private ?Page $translatable = null;
    
    #[ORM\ManyToOne(targetEntity: Language::class)]
    private ?Language $language = null;
}
```

#### Contraintes d'int√©grit√©
- **Unicit√©** : Une seule traduction par langue et entit√©
- **Cascade** : Suppression automatique des traductions
- **Index** : Optimisation des requ√™tes par (translatable_id, language_id)

### Base de donn√©es

#### Tables principales
```sql
-- Langues
CREATE TABLE language (
    id INTEGER PRIMARY KEY,
    code VARCHAR(10) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    native_name VARCHAR(255) NOT NULL,
    is_active BOOLEAN DEFAULT 1,
    is_default BOOLEAN DEFAULT 0,
    sort_order INTEGER DEFAULT 0
);

-- Traductions des pages
CREATE TABLE page_translations (
    id INTEGER PRIMARY KEY,
    translatable_id INTEGER NOT NULL,
    language_id INTEGER NOT NULL,
    title VARCHAR(255),
    content TEXT,
    meta_description TEXT,
    UNIQUE(translatable_id, language_id)
);
```

#### Index de performance
```sql
-- Index de recherche optimis√©
CREATE INDEX idx_page_translations_lookup 
ON page_translations (translatable_id, language_id);

-- Index de langue
CREATE INDEX idx_page_translations_language 
ON page_translations (language_id);
```

### Services et repositories

#### Repository pattern
```php
class PageTranslationRepository extends ServiceEntityRepository
{
    public function findByPageAndLanguage(Page $page, Language $language): ?PageTranslation
    {
        return $this->findOneBy([
            'translatable' => $page,
            'language' => $language
        ]);
    }
    
    public function findPagesWithoutTranslation(Language $language): array
    {
        return $this->createQueryBuilder('pt')
            ->select('p')
            ->rightJoin('pt.translatable', 'p')
            ->leftJoin('p.translations', 't', 'WITH', 't.language = :language')
            ->where('t.id IS NULL')
            ->setParameter('language', $language)
            ->getQuery()
            ->getResult();
    }
}
```

---

## üîç Tests et validation

### Tests d'int√©gration

```bash
# Ex√©cuter tous les tests Oragon
php bin/phpunit tests/Integration/OragonTranslationSystemTest.php

# Tests sp√©cifiques
php bin/phpunit --filter testPageTranslationOragonPattern
```

### Validation du syst√®me

```bash
# V√©rification compl√®te
php bin/console app:cleanup:gedmo --dry-run

# Contr√¥le d'int√©grit√©
php bin/console doctrine:schema:validate
```

---

## üìà Performance et optimisation

### M√©triques de performance

#### Base de donn√©es
- **Index optimis√©s** : Recherche O(log n) sur (translatable_id, language_id)
- **Contraintes d'int√©grit√©** : Pr√©vention des doublons
- **Cascade Delete** : Nettoyage automatique

#### M√©moire
- **Lazy Loading** : Chargement √† la demande des traductions
- **Collection optimis√©e** : Utilisation d'ArrayCollection
- **Cache de second niveau** : Support Doctrine (optionnel)

### Monitoring

```php
// Statistiques de traduction
$stats = $translationManager->getStatistics();
/*
[
    'total_entities' => 150,
    'total_translations' => 450,
    'completion_rate' => 75.0,
    'languages' => 4
]
*/

// Performance par entit√©
$entityStats = $translationManager->getEntityStatistics('page');
/*
[
    'entity_count' => 25,
    'translation_count' => 75,
    'completion_by_language' => [
        'fr' => 100,
        'en' => 80,
        'es' => 60
    ]
]
*/
```

---

## üîß Maintenance et d√©pannage

### Probl√®mes courants

#### 1. Translations manquantes
```bash
# Diagnostic
php bin/console app:translation:sync --stats

# Correction
php bin/console app:translation:sync --all-domains
```

#### 2. Contrainte d'unicit√© viol√©e
```sql
-- Identifier les doublons
SELECT translatable_id, language_id, COUNT(*) 
FROM page_translations 
GROUP BY translatable_id, language_id 
HAVING COUNT(*) > 1;

-- Supprimer les doublons (garder le plus r√©cent)
DELETE p1 FROM page_translations p1
INNER JOIN page_translations p2 
WHERE p1.id < p2.id 
AND p1.translatable_id = p2.translatable_id 
AND p1.language_id = p2.language_id;
```

#### 3. Performance d√©grad√©e
```bash
# Optimisation de la base
php bin/console app:cleanup:gedmo --optimize

# Reconstruction des index
php bin/console doctrine:schema:update --force
```

### Sauvegarde et restauration

```bash
# Export des traductions
php bin/console app:translation:export --all --format=json > backup.json

# Import des traductions
php bin/console app:translation:import backup.json

# Export par entit√©
php bin/console app:translation:export --entity=page --format=yaml > pages.yaml
```

---

## üìö R√©f√©rence API

### Extension Twig

```twig
{# Fonctions principales #}
{{ oragon_translate(key, domain, locale, parameters, fallback) }}
{{ oragon_t(key, domain) }}

{# Informations syst√®me #}
{{ oragon_languages() }}
{{ oragon_current_language() }}
{{ oragon_translation_stats(domain) }}
{{ oragon_translation_completion() }}

{# Filtres #}
{{ key|oragon_translate(domain) }}
{{ key|oragon_format(parameters) }}
{{ key|oragon_fallback(default) }}

{# Conditions #}
{% if oragon_has_translation(key, domain) %}
    {{ oragon_t(key, domain) }}
{% endif %}
```

### Services PHP

```php
// Injection du service
public function __construct(
    private TranslationManagerService $translationManager
) {}

// Utilisation
$translation = $this->translationManager->getTranslation($key, $locale, $domain);
$stats = $this->translationManager->getStatistics();
$this->translationManager->setTranslation($key, $value, $locale, $domain);
```

---

## üéØ Bonnes pratiques

### D√©veloppement

1. **Nommage des cl√©s**
   ```
   Format: {section}.{subsection}.{element}
   Exemple: nav.main.home, admin.users.create, forms.validation.required
   ```

2. **Organisation des domaines**
   ```
   messages: Interface utilisateur g√©n√©rale
   admin: Interface d'administration
   forms: Messages de formulaires
   emails: Templates d'emails
   ```

3. **Gestion des param√®tres**
   ```twig
   <!-- Bon -->
   {{ oragon_t('welcome.user', 'messages', null, {'name': user.name}) }}
   
   <!-- √âviter -->
   {{ oragon_t('welcome') ~ ' ' ~ user.name }}
   ```

### Administration

1. **Workflow de traduction**
   - Cr√©er le contenu en langue par d√©faut
   - Utiliser "Copier depuis d√©faut" comme base
   - Adapter le contenu √† chaque langue
   - Valider avec les compteurs de caract√®res

2. **Gestion des langues**
   - Activer les langues progressivement
   - Utiliser l'ordre de tri pour prioriser
   - Marquer une langue par d√©faut claire

3. **Maintenance r√©guli√®re**
   ```bash
   # Hebdomadaire
   php bin/console app:translation:sync --stats
   
   # Mensuel
   php bin/console app:cleanup:gedmo --dry-run
   
   # Avant d√©ploiement
   php bin/console doctrine:schema:validate
   ```

---

## üèÜ Syst√®me termin√©

### ‚úÖ Fonctionnalit√©s compl√®tes

- **6 entit√©s traduites** : Page, Seo, Bank, Notification, Faq, LoanType
- **Interface d'administration compl√®te** : Dashboard, √©diteurs, actions en masse
- **Outils CLI complets** : Synchronisation, migration, nettoyage
- **Tests d'int√©gration** : Validation automatique du syst√®me
- **Documentation compl√®te** : Guides technique et utilisateur
- **Optimisations** : Index, contraintes, performance

### üéØ Pr√™t pour la production

Le syst√®me Oragon est **100% op√©rationnel** et pr√™t pour un d√©ploiement en production. Tous les composants ont √©t√© test√©s et optimis√©s.

---

**¬© 2025 - Syst√®me Oragon pour LoanMaster - D√©velopp√© par MiniMax Agent**
